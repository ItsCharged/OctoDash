<div class="setup">
  <div class="top-bar">
    <div class="top-bar__side" [ngClass]="{ 'top-bar__side-hidden': !showBackButton() }" matRipple>
      <div *ngIf="showBackButton()" (click)="decreasePage()">
        <img src="assets/back.svg" class="top-bar__side-icon top-bar__side-icon-left" />
        <span i18n="@@setup-back">back</span>
      </div>
    </div>

    <div class="top-bar__center">
      <div class="setup__progress-bar-wrapper">
        <div class="setup__progress-bar" id="progressBar"></div>
      </div>
    </div>

    <div class="top-bar__side" [ngClass]="{ 'top-bar__side-hidden': !showNextButton() }" matRipple>
      <div *ngIf="showNextButton()" (click)="increasePage()">
        <span i18n="@@setup-next">next</span>
        <img src="assets/next.svg" class="top-bar__side-icon top-bar__side-icon-right" />
      </div>
    </div>
  </div>

  <app-config-setup-welcome [update]="configUpdate" *ngIf="page === 0"></app-config-setup-welcome>

  <app-config-setup-choose-backend
    *ngIf="page === 1"
    (increasePage)="increasePage()"
    (configGenerated)="useNewConfig($event)">
  </app-config-setup-choose-backend>

  <app-config-setup-discover-backend
    *ngIf="page === 2"
    [backendType]="config.backend.type"
    [(backend)]="config.backend.url"
    (increasePage)="increasePage()"
    (changeURLEntryMethod)="changeURLEntryMethod($event)">
  </app-config-setup-discover-backend>

  <app-config-setup-octoprint-authentication
    [octoprintURL]="config.backend.url"
    (increasePage)="increasePage()"
    [(accessToken)]="config.backend.accessToken"
    *ngIf="page === 3 && hasOctoprintBackend()"></app-config-setup-octoprint-authentication>

  <app-config-setup-moonraker-authentication
    (increasePage)="increasePage()"
    [(accessToken)]="config.backend.accessToken"
    *ngIf="page === 3 && hasMoonrakerBackend()"></app-config-setup-moonraker-authentication>

  <app-config-setup-personalization
    [backendUrl]="config.backend.url"
    [backendType]="config.backend.type"
    [apiKey]="config.backend.accessToken"
    [(printerName)]="config.printer.name"
    [(useTouchscreen)]="config.screen.touchscreen"
    *ngIf="page === 4"></app-config-setup-personalization>

  <app-config-setup-filament-change
    [backendType]="config.backend.type"
    [(filamentChange)]="config.filamentChange"
    *ngIf="page === 5"></app-config-setup-filament-change>

  <app-config-setup-plugins
    *ngIf="page === 6"
    [(octoprintPlugins)]="config.octoprint.plugins"></app-config-setup-plugins>

  <div *ngIf="page === 7">
    <span class="setup__text" i18n="@@checking">Great! I'll check everything.</span>
    <div class="setup__validation-check-wrapper">
      <span class="setup__validation-check">
        <fa-icon [icon]="['fas', backendConnection ? 'check' : 'xmark']" [ngClass]="{'icon-good': backendConnection, 'icon-bad': !backendConnection}"></fa-icon>
        <ng-container i18n="@@checking-octoprint-connection"> Backend Connection </ng-container>
      </span>
      <div *ngIf="backendConnection">
        <span class="setup__validation-check">
          <fa-icon [icon]="['fas', configValid ? 'check' : 'xmark']" [ngClass]="{'icon-good': configValid, 'icon-bad': !configValid}"></fa-icon>
          <ng-container i18n="@@checking-config"> Validating Config </ng-container>
        </span>
      </div>
      <div *ngIf="configValid">
        <span class="setup__validation-check">
          <fa-icon [icon]="['fas', configValid ? 'check' : 'xmark']" [ngClass]="{'icon-good': configValid, 'icon-bad': !configValid}"></fa-icon>
          <ng-container i18n="@@checking-save"> Saving Config </ng-container>
        </span>
      </div>
      <span class="setup__validation-errors" *ngFor="let error of configErrors">{{ error }}</span>
      <span *ngIf="configValid" class="setup__button" (click)="finishWizard()" i18n="@@wizard-done">done</span>
    </div>
  </div>
</div>
